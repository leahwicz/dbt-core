# This is a workflow to run our unit and integration tests for windows and mac

name: dbt Tests

# Triggers
on:
  # Triggers the workflow on push or pull request events but only for the develop branch
  push:
    branches: [ develop ]
  pull_request:
    branches: 
      - 'develop' 
      - '*.latest' 
      - 'pr/*'
      - 'releases/*'
  pull_request_target:  
    branches: [ develop ]
  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
      
  PostgresIntegrationTest:
    strategy:
      matrix:
        os: [windows-latest, macos-latest]
    runs-on: ${{ matrix.os }}
    environment: 'Postgres'
    steps:
    - name: 'Install postgresql and set up database'
      run: |
          postgres -D /usr/local/var/postgres
          rm -rf /usr/local/var/postgres && initdb /usr/local/var/postgres -E utf8
          brew services restart postgresql
          createdb dbt
          psql
      

